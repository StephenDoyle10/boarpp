
<div class="container-fluid">
	<div class ="row no-gutters">
		<div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-12 mx-auto">
			<div class="standard-box">
				<form action="/posts/store" method="POST" enctype="multipart/form-data">
					<textarea id="summernoteNPL" name="body"></textarea>
					<script>
						$('#summernoteNPL').summernote({
        placeholder: 'What have you been playing recently?',
        tabsize: 2,
        height: 100,
        toolbar: [
            [ 'style', [ 'style' ] ],
            [ 'font', [ 'bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear'] ],
            [ 'fontname', [ 'fontname' ] ],
            [ 'fontsize', [ 'fontsize' ] ],
            [ 'color', [ 'color' ] ],
            [ 'para', [ 'ol', 'ul', 'paragraph', 'height' ] ],
            [ 'table', [ 'table' ] ],
            [ 'insert', [ 'link'] ],
            [ 'view', [ 'undo', 'redo', 'fullscreen', 'codeview', 'help' ] ]
        ]
      });
					</script>
					

					<label>Upload image(optional):</label>
					<input type="file" id="file-input">
					<img id="preview" src="">
					<button type="submit" class="postbutton" id="sendMessageButton">Post</button>
				


				</form>
			</div>
		</div>
	</div>
</div>

<script>


function uploadFile(file, signedRequest, url){
  const xhr = new XMLHttpRequest();
  xhr.open('PUT', signedRequest);
  xhr.onreadystatechange = () => {
  	console.log("uploadfile first");
    if(xhr.readyState === 4){
    	console.log("uploadfile second");
      if(xhr.status === 200){
      	console.log("uploadfile third");
        document.getElementById('preview').src = url;
        document.getElementById('avatar-url').value = url;
      }
      else{
        alert('Could not upload file.');
      }
    }
  };
  xhr.send(file);
}


  	function getSignedRequest(file){
  const xhr = new XMLHttpRequest();
  xhr.open('GET', `/sign-s3?file-name=${file.name}&file-type=${file.type}`);
  xhr.onreadystatechange = () => {
  	console.log("getsignedrequest first");
    if(xhr.readyState === 4){
    	console.log("getsignedrequest second");
      if(xhr.status === 200){
      	console.log("getsignedrequest third");
        const response = JSON.parse(xhr.responseText);
        console.log(response);
        uploadFile(file, response.signedRequest, response.url);
      }
      else{
        alert('Could not get signed URL.');
      }
    }
  };
  xhr.send();
}



  	(() => {
  document.getElementById("file-input").onchange = () => {
    const files = document.getElementById('file-input').files;
    const file = files[0];
    if(file == null){
      return alert('No file selected.');
    }
    getSignedRequest(file);
  };
})();



  </script>
